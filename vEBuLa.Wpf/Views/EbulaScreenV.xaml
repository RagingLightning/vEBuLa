<UserControl x:Class="vEBuLa.Views.EbulaScreenV"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:vEBuLa.Views"
             xmlns:conv="clr-namespace:vEBuLa.XamlConverter"
             xmlns:bx="clr-namespace:vEBuLa.Extensions"
             xmlns:vm="clr-namespace:vEBuLa.ViewModels"
             mc:Ignorable="d" 
             Height="600" Width="800" d:DataContext="{d:DesignInstance vm:EbulaScreenVM}">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolVis"/>
        <conv:BoolHideConverter x:Key="BoolHide"/>
        <conv:NullHideConverter x:Key="NullHide"/>
        <conv:NullVisConverter x:Key="NullVis"/>
        <ContextMenu x:Key="EditMenu">
            <MenuItem Header="Add Entry above" Command="{Binding DataContext.AddEntryCommand, RelativeSource={RelativeSource AncestorType=local:EbulaScreenV}}" CommandParameter="{Binding .}"/>
            <Separator/>
            <MenuItem Header="Remove Entry" Command="{Binding DataContext.RemoveEntryCommand, RelativeSource={RelativeSource AncestorType=local:EbulaScreenV}}" CommandParameter="{Binding .}"/>
        </ContextMenu>
        <Style x:Key="EbulaEntryStyle" TargetType="UserControl">
            <Setter Property="ContextMenu" Value="{DynamicResource EditMenu}"/>
            <Style.Triggers>
                <Trigger Property="TabIndex" Value="0">
                    <Trigger.Setters>
                        <Setter Property="ContextMenu" Value="{x:Null}"/>
                    </Trigger.Setters>
                </Trigger>
            </Style.Triggers>
        </Style>
        <DataTemplate DataType="{x:Type vm:EbulaEntryVM}">
            <local:EbulaEntryV Style="{StaticResource EbulaEntryStyle}" TabIndex="{Binding DataContext.Ebula.EditMode, RelativeSource={RelativeSource AncestorType=local:EbulaScreenV}}"/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:EbulaMarkerEntryVM}">
            <local:EbulaMarkerEntryV Style="{StaticResource EbulaEntryStyle}" TabIndex="1"/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:EbulaControlPopupVM}">
            <local:EbulaControlPopupV/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:ServiceNumberPopupVM}">
            <local:ServiceNumberPopupV/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:NoServicePopupVM}">
            <local:NoServicePopupV/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:SelectServicePopupVM}">
            <local:SelectServicePopupV/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:SelectConfigPopupVM}">
            <local:SelectConfigPopupV/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:SelectVehiclePopupVM}">
            <local:SelectVehiclePopupV/>
        </DataTemplate>
        <Style x:Key="ListContainerStyle" TargetType="ListViewItem">
            <Setter Property="Padding" Value="0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="BorderBrush" Value="{Binding BorderBrush, RelativeSource={RelativeSource AncestorType=ListView}}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ListViewItem}">
                        <Grid>
                            <Rectangle Fill="{TemplateBinding BorderBrush}" Height="2" VerticalAlignment="Top" Panel.ZIndex="5"/>
                            <ContentPresenter />
                            <Rectangle Fill="{TemplateBinding BorderBrush}" Height="2" VerticalAlignment="Bottom" Panel.ZIndex="5"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="False">
                    <Setter Property="BorderBrush" Value="{x:Null}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="ListStyle" TargetType="ListView">
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="-1"/>
            <Setter Property="ItemContainerStyle" Value="{StaticResource ListContainerStyle}"/>
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Hidden"/>
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Hidden"/>
        </Style>
        <Style TargetType="Button">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border BorderThickness="1,1,0,0" BorderBrush="White">
                            <Border BorderThickness="0,0,1,1" BorderBrush="Black">
                                <TextBlock VerticalAlignment="Center" TextAlignment="Center" Text="{TemplateBinding Content}"/>
                            </Border>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>
    <Grid>
        <!-- Main Screen-->
        <DockPanel Background="White">
            <Grid DockPanel.Dock="Top" Height="37">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="7*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="3*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="3*"/>
                </Grid.ColumnDefinitions>

                <Rectangle Grid.Column="1" Fill="Black" Width="3"/>
                <Rectangle Grid.Column="3" Fill="Black" Width="3"/>
                <Rectangle Grid.Column="5" Fill="Black" Width="3"/>

                <TextBlock Grid.Column="0" Text="{Binding Ebula.Service.Name}" d:Text="10901" TextAlignment="Center" VerticalAlignment="Center" FontSize="20" FontWeight="Bold"/>
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock Text="Fahrplan " TextAlignment="Center" VerticalAlignment="Center" FontSize="20" FontWeight="Bold"/>
                    <TextBlock Text="un" TextAlignment="Center" VerticalAlignment="Center" FontSize="20" FontWeight="Bold" Visibility="{Binding InvalidRoute, Converter={StaticResource BoolVis}}"/>
                    <TextBlock Text="gültig!" TextAlignment="Center" VerticalAlignment="Center" FontSize="20" FontWeight="Bold"/>
                </StackPanel>
                <TextBlock Grid.Column="4" Text="{Binding Ebula.FormattedDate}" d:Text="07.06.2018" TextAlignment="Center" VerticalAlignment="Center" FontSize="20" FontWeight="Bold"/>
                <TextBlock Grid.Column="6" Text="{Binding Ebula.FormattedTime}" d:Text="07:02:59" TextAlignment="Center" VerticalAlignment="Center" FontSize="20" FontWeight="Bold"/>
            </Grid>
            <Rectangle DockPanel.Dock="Top" Fill="Black" Height="3"/>
            <!--<TextBlock Text="{Binding BottomStatus}" d:Text="BottomStatus" TextAlignment="Center" VerticalAlignment="Center" FontSize="15" FontWeight="Bold"/>-->
            <DockPanel DockPanel.Dock="Top" Height="22" LastChildFill="False">
                <TextBlock DockPanel.Dock="Left" Visibility="{Binding SpeedInfo, Converter={StaticResource NullVis}}" Text="{Binding SpeedInfo}" d:Text="ab km 58,4: 80 km/h" TextAlignment="Center" VerticalAlignment="Center" FontSize="15" FontWeight="Bold" Margin="5,0"/>
                <Rectangle DockPanel.Dock="Left" Visibility="{Binding SpeedInfo, Converter={StaticResource NullVis}}" Fill="Black" Width="3"/>

                <TextBlock DockPanel.Dock="Right" Visibility="{Binding StopInfo, Converter={StaticResource NullVis}}" Text="{Binding StopInfo}" d:Text="Nächster Halt: Schlachtern (Sieg)" TextAlignment="Center" VerticalAlignment="Center" FontSize="15" FontWeight="Bold" Margin="5,0"/>
                <Rectangle DockPanel.Dock="Right" Visibility="{Binding StopInfo, Converter={StaticResource NullVis}}" Fill="Black" Width="3"/>
            </DockPanel>
            <Rectangle DockPanel.Dock="Top" Fill="Black" Height="3"/>

            <Grid DockPanel.Dock="Bottom" Background="LightGray" Height="37">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0" Content="{Binding ButtonLabel0}" Visibility="{Binding ButtonLabel0, Converter={StaticResource NullHide}}" d:Content="Zug" Height="30" VerticalAlignment="Center" Margin="5,0"/>
                <Button Grid.Column="1" Content="{Binding ButtonLabel1}" Visibility="{Binding ButtonLabel1, Converter={StaticResource NullHide}}" d:Content="FSD" Height="30" VerticalAlignment="Center" Margin="5,0"/>
                <Button Grid.Column="2" Content="{Binding ButtonLabel2}" Visibility="{Binding ButtonLabel2, Converter={StaticResource NullHide}}" d:Content="Zug" Height="30" VerticalAlignment="Center" Margin="5,0"/>
                <Button Grid.Column="3" Content="{Binding ButtonLabel3}" Visibility="{Binding ButtonLabel3, Converter={StaticResource NullHide}}" d:Content="Zug" Height="30" VerticalAlignment="Center" Margin="5,0"/>
                <Button Grid.Column="4" Content="{Binding ButtonLabel4}" Visibility="{Binding ButtonLabel4, Converter={StaticResource NullHide}}" d:Content="LW" Height="30" VerticalAlignment="Center" Margin="5,0"/>
                <Button Grid.Column="5" Content="{Binding ButtonLabel5}" Visibility="{Binding ButtonLabel5, Converter={StaticResource NullHide}}" d:Content="GW" Height="30" VerticalAlignment="Center" Margin="5,0"/>
                <Button Grid.Column="6" Content="{Binding ButtonLabel6}" Visibility="{Binding ButtonLabel6, Converter={StaticResource NullHide}}" d:Content="Zeit" Height="30" VerticalAlignment="Center" Margin="5,0"/>
                <Button Grid.Column="7" Content="{Binding ButtonLabel7}" Visibility="{Binding ButtonLabel7, Converter={StaticResource NullHide}}" d:Content="Zug" Height="30" VerticalAlignment="Center" Margin="5,0"/>
                <Button Grid.Column="8" Content="{Binding ButtonLabel8}" Visibility="{Binding ButtonLabel8, Converter={StaticResource NullHide}}" d:Content="Zug" Height="30" VerticalAlignment="Center" Margin="5,0"/>
                <Button Grid.Column="9" Content="{Binding ButtonLabel9}" Visibility="{Binding ButtonLabel9, Converter={StaticResource NullHide}}" d:Content="G" Height="30" VerticalAlignment="Center" Margin="5,0"/>
            </Grid>

            <Grid DockPanel.Dock="Bottom" Height="30" Background="#fffdf4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="2.6*"/>
                    <ColumnDefinition Width="0.85*"/>
                    <ColumnDefinition Width="0.8*"/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="3.3*"/>
                </Grid.ColumnDefinitions>
                <Image Source="../gpsScroll.png" HorizontalAlignment="Left" VerticalAlignment="Top" Width="21" Height="26" Margin="3,4,0,0" d:Visibility="Visible" Visibility="{Binding PositionScrolling, Converter={StaticResource BoolHide}}" SnapsToDevicePixels="True"/>
                <Image Source="../timeScroll.png" HorizontalAlignment="Left" VerticalAlignment="Top" Width="20" Height="22" Margin="2,2,0,0" d:Visibility="Hidden" Visibility="{Binding TimeScrolling, Converter={StaticResource BoolHide}}" SnapsToDevicePixels="True"/>
                <Image Source="../manualScroll.png" HorizontalAlignment="Left" VerticalAlignment="Top" Width="21" Height="26" Margin="3,1,0,0" d:Visibility="Hidden" Visibility="{Binding ManualScrolling, Converter={StaticResource BoolHide}}" SnapsToDevicePixels="True"/>

                <TextBlock Grid.Column="2" VerticalAlignment="Center" Text="RW /r" FontSize="16"/>
                <Border Grid.Column="3" BorderThickness="1" BorderBrush="Black" Margin="2">
                    <TextBlock Text="600 A" VerticalAlignment="Center" TextAlignment="Center" FontSize="16"/>
                </Border>
                <TextBlock Grid.Column="4" VerticalAlignment="Center" Text="GSM-R" FontSize="16" Margin="15,0,0,0"/>
                <StackPanel Orientation="Horizontal" Grid.Column="5" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,5,0" Visibility="{Binding HasDelay, Converter={StaticResource BoolHide}}">
                    <TextBlock Text="+" FontSize="16" Visibility="{Binding PositiveDelay, Converter={StaticResource BoolHide}}"/>
                    <TextBlock Text="{Binding ServiceDelay}" d:Text="17" FontSize="16"/>
                    <TextBlock Text="{Binding ServiceDelayFr}" d:Text=".3" FontSize="12" VerticalAlignment="Bottom" Margin="0,0,0,1"/>
                    <TextBlock Text=" min" FontSize="16"/>
                </StackPanel>
                <Rectangle Grid.Column="6" Width="3" Fill="Black"/>
                <Grid Grid.Column="7" HorizontalAlignment="Right" VerticalAlignment="Center" Background="White">
                    <TextBlock Text="{Binding EditModeMemo}" d:Text="! RTE EDIT MODE !" FontSize="16"/>
                </Grid>
            </Grid>
            <Rectangle DockPanel.Dock="Bottom" Height="3" Fill="Black"/>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="3*"/>
                    <ColumnDefinition Width="22"/>
                    <ColumnDefinition Width="3*"/>
                    <ColumnDefinition Width="6"/>
                    <ColumnDefinition Width="22"/>
                    <ColumnDefinition Width="9*"/>
                    <ColumnDefinition Width="3"/>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="3"/>
                    <ColumnDefinition Width="2*"/>
                </Grid.ColumnDefinitions>

                <Rectangle Grid.Column="1" Fill="Black" Width="3" Panel.ZIndex="2"/>
                <Rectangle Grid.Column="4" Fill="Black" Width="3" Panel.ZIndex="10" IsHitTestVisible="False"/>
                <Rectangle Grid.Column="6" Fill="Black" Width="3" Panel.ZIndex="2"/>
                <Rectangle Grid.Column="8" Fill="Black" Width="3" Panel.ZIndex="2"/>

                <ListView Panel.ZIndex="5" Background="Transparent" Grid.ColumnSpan="10" ItemsSource="{Binding ActiveEntries}" Style="{StaticResource ListStyle}" BorderBrush="{Binding RowHighlight}" SelectedItem="{Binding SelectedEntry, UpdateSourceTrigger=PropertyChanged}" PreviewMouseWheel="ListView_PreviewMouseWheel" PreviewKeyDown="ListView_PreviewKeyDown">
                    <b:Interaction.Behaviors>
                        <bx:ScrollIntoView/>
                    </b:Interaction.Behaviors>
                </ListView>
            </Grid>
        </DockPanel>
        <!-- Popup Windows -->
        <ContentControl Panel.ZIndex="100" Background="Transparent" IsHitTestVisible="False" Content="{Binding PopupWindow}"/>
    </Grid>
</UserControl>
